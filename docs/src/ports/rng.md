# 端口：随机数生成器 (`rng.ts`)

该文件定义了随机数生成（Random Number Generator）的“端口”。它提供了一个标准接口 `RngPort`，用于在领域层中获取随机数。

## 核心设计

- **可注入性与可测试性**: 将随机数生成抽象为一个端口，最大的好处是实现了“依赖注入”。在正常的应用运行中，可以注入一个基于 `Math.random()` 的标准实现。但在自动化测试中，可以注入一个“伪随机”或“种子随机”的实现。这使得所有依赖随机性的逻辑（例如，子弹的随机散射、AI的随机决策）都变得完全可预测和可复现，极大地提高了测试的可靠性。

## 接口与类型

### `RngPort` 接口

随机数生成器端口的契约。

- **`next(): number`**:
  - **描述**: 返回一个随机数。
  - **返回**: 一个在 `[0, 1)` 区间内的浮点数（包含 0，不包含 1），与 `Math.random()` 的行为一致。

## 使用流程

1.  **装配**:
    - **生产环境**: 在应用启动时，可以创建一个简单的 `RngPort` 实现，其 `next()` 方法直接调用 `Math.random()`，并将其注册到 `world.ports.rng`。
    - **测试环境**: 在测试设置中，创建一个可预测的 `RngPort` 实现（例如，一个总是按顺序返回 `[0.1, 0.5, 0.8, ...]` 的模拟对象，或者一个基于固定种子的库），并将其注册。

2.  **系统内使用**: 任何需要随机性的系统，不再直接调用 `Math.random()`，而是通过 `world.ports.rng.next()` 来获取随机数。

    ```typescript
    // 在某个 System 的 update 方法中
    const randomFactor = world.ports.rng.next(); // -> 0.75
    const spreadAngle = (randomFactor - 0.5) * MAX_SPREAD;
    // ...
    ```
