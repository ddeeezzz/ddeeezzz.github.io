### 语言、编码规范

* **读写文件**：使用utf-8编码。
* **文档与交流**：统一使用中文撰写所有文档与沟通内容，包括推理过程，使用utf-8编码。
* **代码**：所有注释与日志必须使用中文，确保描述清晰，使用utf-8编码。

---

### 增加、修改、删除功能，改bug流程

* **标准流程**：在用户给出需求后必须先给出十分的详细计划，等待用户确认后开始修改，如果修改或增加函数，那么每一个修改或增加的函数都需要添加调试日志和注释，修改完成后进行测试，测试完成后询问用户是否注释掉/删除调试日志

---

### 项目结构与模块组织
* **应用代码 (`src`)**：所有核心游戏逻辑与 Three.js 代码位于 `src/` 目录，建议按功能或领域划分：
  * `/components`: 游戏实体（例如玩家、敌人）的类与行为逻辑。
  * `/scenes`: 各类游戏场景或关卡的定义。
  * `/utils`: 通用的辅助函数与数学工具。
* **静态资源 (`assets`)**：3D 模型（.glb、.obj）、纹理（.jpg、.png）与音频文件集中放置于 `assets/`。
* **开发工具 (`scripts`)**：构建、部署与自动化脚本（包含 Vite 配置）统一存放在 `scripts/`。

---

### 构建、测试与开发命令
为保持一致的开发体验，请优先使用项目内置脚本，而非全局安装的工具。
* **`npm install`**：安装全部依赖（包含 Three.js 与构建工具）。
* **`npm run dev`**：启动本地开发服务器，支持热重载以便实时调试。
* **`npm run build`**：构建生产版本，压缩打包所有 Three.js 模块与资源。
* **`npm run test`**：执行单元测试，确保代码稳定。

---

### 编码风格与命名约定
* **函数注释**：每个函数必须附详细注释，说明功能、参数类型与含义，以及返回值的类型与意义。
* **日志打印**：实现新功能时需在关键节点记录中文日志，例如“玩家跳跃功能已激活”“纹理加载完成”。
* **缩进**：统一使用 2 个空格缩进。
* **命名规范**：
  * **类与类型**：使用 PascalCase，例如 `PlayerCharacter.js`。
  * **变量与函数**：使用 camelCase，例如 `loadTexture()`。
  * **文件**：使用 kebab-case，例如 `player-controls.js`。
* **测试文件**：测试文件名需以 `.spec.js` 结尾。
* **松耦合**：尽可能将高度重复利用的功能封装成一个类，比如销毁对象。使用面向对象的思维，让场景结构清晰化。

---

### 测试指南
* **测试框架**：推荐使用 Vitest 编写单元测试。
* **测试编写**：开发新功能时同步补充对应测试，测试文件路径需与源代码保持一致。
* **本地运行**：提交前必须运行 `npm run test` 确认全部用例通过。

---

### 提交与拉取请求指引
* **提交信息**：遵循中文 Conventional Commits，主题需简洁明了，例如 `feat: 添加玩家跳跃功能`。
* **拉取请求（PR）**：
  * 标题需清晰，描述需包含改动详情。
  * 关联相关 Issue（示例：`关闭 #123`）。
  * 若涉及视觉改动，请附上截图或动图。

---

### 安全与配置提醒
* **敏感信息**：禁止将任何 API 密钥、密码等敏感信息提交到 Git 仓库，请通过 `.env` 等环境变量管理。
* **依赖版本**：在 `package.json` 与 `package-lock.json` 中锁定依赖版本，避免使用 `latest`。

---

### 代理特定指令
* **文件范围**：`AGENTS.md` 负责规范整个仓库根目录。
* **提交**：保持改动最小且聚焦，每个 PR 仅包含一个逻辑变更。
* **保持一致**：沿用既有代码模式与项目脚本，未经讨论不得引入新工具或框架。
* **计划要求**：制定计划时需列出预计修改、创建或删除的文件。

---

### 进度保存/读取流程（建议）
* 保存进度：运行 `npm run ctx:save`，生成 `.context/context.json`。
* 保存并记录日志：运行 `npm run ctx:save:log`，向 `docs/SESSION_LOG.md` 追加“自动快照”。
* 读取进度：运行 `npm run ctx:load`，获取概要、未完成任务及恢复提示。
* 新会话建议：先执行 `npm run ctx:load`，再对照 `AGENTS.md` 与 `docs/SESSION_LOG.md` 行动。
* 已集成钩子：
  * `predev` 自动读取进度，`postdev` 自动保存并追加日志。
  * `prepreview`/`postpreview` 及 `postbuild` 同步执行保存/读取流程。

---

### 导入（import）注释规范
- 所有 `import` 语句必须附中文注释，说明引入内容及用途。
- 注释可写在同一行尾部或上一行，须紧邻 `import` 语句。
- 示例：
  - `import * as THREE from 'three' // Three.js 渲染核心库`
  - `import { composeApp } from './setup' // 应用装配入口，用于初始化端口与世界`

### 导出（export）注释规范
- 所有导出（含 `export default`、类、接口、函数等）均需附中文注释，说明导出对象的使用方与用途。
- 注释需紧贴导出声明，可写于上一行或同行。
- 示例：
  - `export interface RenderPort { ... } // 导出：渲染端口契约，供领域层依赖`
  - `export default defineConfig({...}) // 导出：Vite 配置供构建工具读取`